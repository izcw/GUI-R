import{d as e,r as n,c as t,a as o,b as s,e as r,f as a,g as i,u as c,o as u,h as l,w as _,i as d,j as m,F as p,k as v,n as f,l as g,t as y,m as I,p as k,q as h,s as b,v as L}from"./vue-BibbW5Km.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&n(e)}).observe(document,{childList:!0,subtree:!0})}function n(e){if(e.ep)return;e.ep=!0;const n=function(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?n.credentials="include":"anonymous"===e.crossOrigin?n.credentials="omit":n.credentials="same-origin",n}(e);fetch(e.href,n)}}();const E={},P=function(e,n,t){let o=Promise.resolve();if(n&&n.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),s=t?.nonce||t?.getAttribute("nonce");o=e(n.map(e=>{if((e=function(e){return"/"+e}(e))in E)return;E[e]=!0;const n=e.endsWith(".css"),t=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${t}`))return;const o=document.createElement("link");return o.rel=n?"stylesheet":"modulepreload",n||(o.as="script"),o.crossOrigin="",o.href=e,s&&o.setAttribute("nonce",s),document.head.appendChild(o),n?new Promise((n,t)=>{o.addEventListener("load",n),o.addEventListener("error",()=>t(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function s(e){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=e,window.dispatchEvent(n),!n.defaultPrevented)throw e}return o.then(n=>{for(const e of n||[])"rejected"===e.status&&s(e.reason);return e().catch(s)})},w="/src/assets/icon/menu/",O={comp:()=>P(()=>Promise.resolve().then(function(){return de}),void 0),key:"Layout-Main",describe:"主布局"},T={comp:()=>P(()=>Promise.resolve().then(function(){return ve}),void 0),key:"Layout-Blank",describe:"空白布局"},$={Theme:"dark",currentLayout:"Layout-Main",currentPage:"Login",Menus:[{permsIndex:0,name:"Control",comp:()=>P(()=>Promise.resolve().then(function(){return be}),void 0),layout:O,permission:["admin","user","guest"],hidden:!1,meta:{icon:`${w}home.svg`,icon_active:`${w}more-active.svg`}},{permsIndex:1,name:"Audio",comp:()=>P(()=>Promise.resolve().then(function(){return Pe}),void 0),layout:O,permission:["admin","user","guest"],meta:{icon:`${w}user.svg`,icon_active:`${w}more-active.svg`}},{permsIndex:2,name:"Configuration",comp:()=>P(()=>Promise.resolve().then(function(){return Te}),void 0),layout:O,permission:["admin","user","guest"],meta:{icon:`${w}user.svg`,icon_active:`${w}more-active.svg`}},{permsIndex:3,name:"CEC",comp:()=>P(()=>Promise.resolve().then(function(){return Ce}),void 0),layout:O,permission:["admin","user"],meta:{icon:`${w}user.svg`,icon_active:`${w}more-active.svg`}},{permsIndex:4,name:"RS232",comp:()=>P(()=>Promise.resolve().then(function(){return Se}),void 0),layout:O,permission:["admin","user"],meta:{icon:`${w}user.svg`,icon_active:`${w}more-active.svg`}},{permsIndex:5,name:"Network",comp:()=>P(()=>Promise.resolve().then(function(){return je}),void 0),layout:O,permission:["admin","user"],meta:{icon:`${w}user.svg`,icon_active:`${w}more-active.svg`}},{permsIndex:6,name:"Upgrade",comp:()=>P(()=>Promise.resolve().then(function(){return Ue}),void 0),layout:O,permission:["admin","user"],meta:{icon:`${w}user.svg`,icon_active:`${w}more-active.svg`}},{permsIndex:7,name:"Diagnostics",comp:()=>P(()=>Promise.resolve().then(function(){return Je}),void 0),layout:O,permission:["admin","user"],meta:{icon:`${w}user.svg`,icon_active:`${w}more-active.svg`}},{permsIndex:8,name:"Admin",comp:()=>P(()=>Promise.resolve().then(function(){return Ge}),void 0),layout:O,permission:["admin","user"],meta:{icon:`${w}user.svg`,icon_active:`${w}more-active.svg`}},{name:"Login",comp:()=>P(()=>Promise.resolve().then(function(){return Xe}),void 0),layout:T,permission:["admin","user","guest"],meta:{icon:`${w}user.svg`,icon_active:`${w}more-active.svg`}},{name:"404",comp:()=>P(()=>Promise.resolve().then(function(){return nn}),void 0),layout:T,permission:["admin","user","guest"],meta:{icon:`${w}user.svg`,icon_active:`${w}more-active.svg`}},{name:"500",comp:()=>P(()=>Promise.resolve().then(function(){return sn}),void 0),layout:T,permission:["admin","user","guest"],meta:{icon:`${w}user.svg`,icon_active:`${w}more-active.svg`}}]},x={set(e,n,t){const o=JSON.stringify(n);"local"===t?localStorage.setItem(e,o):"session"===t&&sessionStorage.setItem(e,o)},get(e,n){let t=null;"local"===n?t=localStorage.getItem(e):"session"===n&&(t=sessionStorage.getItem(e));try{return t?JSON.parse(t):null}catch{return null}},remove(e,n){"local"===n?localStorage.removeItem(e):"session"===n&&sessionStorage.removeItem(e)},clear(e){"local"===e?localStorage.clear():"session"===e&&sessionStorage.clear()}},C="demo-access-secret",A="demo-refresh-secret";function D(e){return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function S(e){return e+="==".substring(0,(4-e.length%4)%4),atob(e.replace(/-/g,"+").replace(/_/g,"/"))}function R(){return Math.floor(Date.now()/1e3)}async function M(e,n){const t=new TextEncoder,o=await crypto.subtle.importKey("raw",t.encode(n),{name:"HMAC",hash:"SHA-256"},!1,["sign"]),s=await crypto.subtle.sign("HMAC",o,t.encode(e)),r=new Uint8Array(s);let a="";for(let i=0;i<r.byteLength;i++)a+=String.fromCharCode(r[i]);return btoa(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}async function j(e,n){const t=D(JSON.stringify({alg:"HS256",typ:"JWT"})),o=D(JSON.stringify(e));return`${t}.${o}.${await M(`${t}.${o}`,n)}`}async function N(e){return j({ID:"anonymous",Name:"guest",Role:"user",Type:"access",ExpTime:e.ExpTime??R()+3600,...e},C)}async function V(e){const n=e.split(".");if(3!==n.length)return null;try{const t="refresh"===(JSON.parse(S(n[1])).Type||"access")?A:C;return await async function(e,n){const t=e.split(".");if(3!==t.length)return null;try{const e=JSON.parse(S(t[1]));return e.ExpTime&&e.ExpTime<R()?null:await M(`${t[0]}.${t[1]}`,n)===t[2]?e:null}catch{return null}}(e,t)}catch(t){return null}}const U="System",B="session",H=e("system",()=>{const e=n($),s=n("dark"===$.Theme),r=n([]),a=n([]),i=n(!1),c=n([]),u=n(-1),l=()=>{const{currentLayout:n,currentPage:t}=e.value;x.set(U,{Theme:s.value?"dark":"light",currentLayout:n,currentPage:t,navigationHistory:c.value,currentHistoryIndex:u.value},B)},_=t(()=>{const n=e.value.Menus.find(n=>n.layout.key===e.value.currentLayout)?.layout;return n?o(n.comp):p("404")}),d=t(()=>{const n=e.value.Menus.find(n=>n.name===e.value.currentPage);return n?o(n.comp):p("404")}),m=e=>{r.value.push(e)},p=async(n,t=!1)=>{if(i.value)return;i.value=!0;const o=e.value.currentPage;try{for(const e of r.value)if(!1===await e(n,o))return;if(!f(n,o))return;const s=e.value.Menus.find(e=>e.name===n);if(s){e.value.currentPage=s.name,e.value.currentLayout=s.layout.key,t||v(n),l();for(const e of a.value)e(n,o);g(n,o)}}catch(s){p("404")}finally{i.value=!1}},v=e=>{c.value[u.value]!==e&&(u.value<c.value.length-1&&(c.value=c.value.slice(0,u.value+1)),c.value.push(e),u.value=c.value.length-1,c.value.length>20&&(c.value.shift(),u.value=c.value.length-1))},f=(n,t)=>{const o=e.value.Menus.find(e=>e.name===n);if(!o)return p("404"),!1;const s="Login"!==e.value.currentPage;return!("Login"!==n&&o.permission&&!o.permission.includes("guest")&&!s&&(p("Login"),1))},g=(e,n)=>{};return(()=>{const n=x.get(U,B);n?(e.value={...e.value,...n},s.value="dark"===n.Theme,n.navigationHistory&&void 0!==n.currentHistoryIndex&&(c.value=n.navigationHistory,u.value=n.currentHistoryIndex)):s.value="dark"===$.Theme,0===c.value.length&&(c.value=[e.value.currentPage],u.value=0),p(e.value.currentPage,!0)})(),document.documentElement.classList.toggle("dark",s.value),m(f),{config:e,isDark:s,navigationHistory:c,currentHistoryIndex:u,currentLayoutComp:_,currentPageComp:d,canGoBack:t(()=>u.value>0),canGoForward:t(()=>u.value<c.value.length-1),navigateTo:p,navigateBack:()=>{if(u.value>0){u.value--;const e=c.value[u.value];p(e,!0)}},navigateForward:()=>{if(u.value<c.value.length-1){u.value++;const e=c.value[u.value];p(e,!0)}},toggleTheme:()=>{s.value=!s.value,e.value.Theme=s.value?"dark":"light",document.documentElement.classList.toggle("dark",s.value),l()},saveToStorage:l,addNavigationGuard:m,addAfterNavigationHook:e=>{a.value.push(e)}}}),J="UserInfo",F="session",q=e("user",()=>{const e=n($),o=t(()=>e.value.Menus),s="admin",r=n(["1","1","0","1","0","1","1","1","1"]),a=n(),i=()=>{let e=o.value.filter((e,n)=>void 0!==e.permsIndex);a.value=e.filter((e,n)=>"1"===r.value[n]&&(e.permission?.includes(s)??!0))};return(()=>{const e=x.get(J,F);e&&(a.value=e.Menus)})(),{saveToStorage:()=>{let e=V(z().accessToken);i(),x.set(J,{Menus:a.value,...e,Perms:{Input:["1","1","0","1","1","0"],Output:["1","1"]}},F)},UserPermissionRole:s,UserMenuPermissions:r,UserMenus:a,Menus:o,setMenus:i}}),G="Token",W="session",z=e("auth",()=>{const e=q(),o=H(),s=n(""),r=n(""),a=n({}),i=t(()=>!!s.value),c=()=>{x.set(G,s.value,W)},u=()=>{s.value="",r.value="",a.value={},x.remove(G,W),x.remove("UserInfo",W),o.navigateTo("Login")};return(()=>{const e=x.get(G,W);e&&(s.value="string"==typeof e?e:"")})(),{accessToken:s,refreshToken:r,userInfo:a,isLogin:i,Login:async n=>{if(s.value&&await V(s.value));else{const e=String(Date.now());let t=Math.floor(Date.now()/1e3)+1800;s.value=await N({ID:"ID"+e,Name:n.username,Role:n.role??"user",ExpTime:t}),r.value=await async function(e){return j({Name:"guest",Role:"user",Type:"refresh",ExpTime:R()+604800,...e},A)}({ID:"ID"+e})}e.saveToStorage(),o.navigateTo(e.Menus[0].name),c()},Logout:u,refreshAccessToken:async()=>{const e=await V(r.value);if(!e)return u();let n=Math.floor(Date.now()/1e3)+1800;s.value=await N({ID:e.ID,Name:a.value.username,Role:a.value.role,ExpTime:n}),c()}}});function K(e){return new Worker("/assets/tokenMonitor.worker-BqQM8_Ow.js",{name:e?.name})}s();let Q=null;const Z={key:1,class:"loading-container"};var X=(e,n)=>{const t=e.t||e;for(const[o,s]of n)t[o]=s;return t},Y=X(r({o:"index",setup(e){const n=H();return(e,t)=>c(n).currentLayoutComp&&c(n).currentPageComp?(u(),a(l(c(n).currentLayoutComp),{key:0},{default:_(()=>[(u(),a(l(c(n).currentPageComp)))]),i:1})):(u(),i("div",Z,[...t[0]||(t[0]=[d("div",{class:"loading-spinner"},[d("div",{class:"spinner"})],-1),d("div",{class:"loading-text"},[d("p",null,"正在加载页面组件...")],-1)])]))}}),[["__scopeId","data-v-4d7bb433"]]);const ee=m(r({o:"App",setup:e=>(e,n)=>(u(),a(Y))}));ee.use(s()),ee.mount("#app"),function(){const e=z(),n=n=>{if(Q&&Q.terminate(),!n)return;const t="string"==typeof n?n:String(n);Q=new K,Q.onmessage=({data:n})=>{"expire"===n&&e.Logout()},Q.postMessage({token:t})};n("string"==typeof e.accessToken?e.accessToken:""),e.$subscribe((e,t)=>{n("string"==typeof t.accessToken?t.accessToken:"")})}();const ne=["onClick"],te=["src"];var oe=X(r({o:"MenuList",setup(e){const n=H(),t=q();return(e,o)=>(u(!0),i(p,null,v(c(t).UserMenus,e=>(u(),i("li",{class:f(["item",{active:c(n).config.currentPage===e.name}]),key:e.name,onClick:t=>c(n).navigateTo(e.name)},[d("img",{src:c(n).config.currentPage===e.name?e.meta?.icon_active:e.meta?.icon,alt:""},null,8,te),g(" "+y(e.name),1)],10,ne))),128))}}),[["__scopeId","data-v-c6306358"]]);const se={class:"NavBar"};var re=r({o:"NavBar",setup:e=>(e,n)=>(u(),i("ul",se,[I(oe)]))});const ae={class:"Footer"},ie={class:"Test"},ce={class:"theme-btn"};var ue=X(r({o:"Footer",setup(e){const n=H(),t=z();return(e,o)=>(u(),i("div",ae,[d("div",ie,[d("div",ce,[d("button",{onClick:o[0]||(o[0]=(...e)=>c(n).toggleTheme&&c(n).toggleTheme(...e))},y(c(n).isDark?"☀️ 浅色":"🌙 深色"),1)]),d("button",{onClick:o[1]||(o[1]=(...e)=>c(t).Logout&&c(t).Logout(...e))}," 退出登录 "),d("button",{onClick:o[2]||(o[2]=e=>c(n).navigateBack())},"后退"),d("button",{onClick:o[3]||(o[3]=e=>c(n).navigateForward())},"前进")])]))}}),[["__scopeId","data-v-4db18314"]]);const le={class:"LeftRightLayout"};var _e=X(r({o:"Layout-Main",setup:e=>(e,n)=>(u(),i("div",le,[d("header",null,[I(re)]),d("main",null,[k(e.$slots,"default",{},void 0)]),d("footer",null,[I(ue)])]))}),[["__scopeId","data-v-d130b3da"]]),de=Object.freeze({__proto__:null,default:_e});const me={class:"BlankLayout"};var pe=X(r({o:"Layout-Blank",setup:e=>(e,n)=>(u(),i("div",me,[d("main",null,[k(e.$slots,"default",{},void 0)])]))}),[["__scopeId","data-v-b0beec12"]]),ve=Object.freeze({__proto__:null,default:pe});const fe={class:"TitleCard"},ge={class:"title"},ye={class:"content"};var Ie=X(r({o:"TitleCard",props:{title:{type:String,required:!0}},setup:e=>(n,t)=>(u(),i("div",fe,[d("div",ge,y(e.title),1),d("div",ye,[k(n.$slots,"default",{},void 0)])]))}),[["__scopeId","data-v-299be701"]]);const ke={class:"Control"};var he=X(r({o:"index",setup(e){const n=H(),t=z();return(e,o)=>(u(),i("div",ke,[o[4]||(o[4]=d("h1",null,"Control",-1)),I(Ie,{title:"Matrix"},{default:_(()=>[...o[2]||(o[2]=[g(" 你好 ",-1)])]),i:1}),I(Ie,{title:"Matrix"},{default:_(()=>[...o[3]||(o[3]=[g(" 你好 ",-1)])]),i:1}),d("button",{onClick:o[0]||(o[0]=e=>c(n).navigateTo("404"))},"点击"),d("button",{onClick:o[1]||(o[1]=e=>c(t).refreshAccessToken())},"刷新Token")]))}}),[["__scopeId","data-v-36b682d5"]]),be=Object.freeze({__proto__:null,default:he});const Le={class:"Audio"};var Ee=X(r({o:"index",setup:e=>(e,n)=>(u(),i("div",Le,[...n[0]||(n[0]=[d("h1",null,"Audio",-1)])]))}),[["__scopeId","data-v-fe2aefb4"]]),Pe=Object.freeze({__proto__:null,default:Ee});const we={class:"Configuration"};var Oe=X(r({o:"index",setup:e=>(e,n)=>(u(),i("div",we,[...n[0]||(n[0]=[d("h1",null,"Configuration",-1)])]))}),[["__scopeId","data-v-572ec7f6"]]),Te=Object.freeze({__proto__:null,default:Oe});const $e={class:"CEC"};var xe=X(r({o:"index",setup:e=>(e,n)=>(u(),i("div",$e,[...n[0]||(n[0]=[d("h1",null,"CEC",-1)])]))}),[["__scopeId","data-v-afc3a014"]]),Ce=Object.freeze({__proto__:null,default:xe});const Ae={class:"RS-232"};var De=X(r({o:"index",setup:e=>(e,n)=>(u(),i("div",Ae,[...n[0]||(n[0]=[d("h1",null,"RS-232",-1)])]))}),[["__scopeId","data-v-97b7ac36"]]),Se=Object.freeze({__proto__:null,default:De});const Re={class:"Network"};var Me=X(r({o:"index",setup:e=>(e,n)=>(u(),i("div",Re,[...n[0]||(n[0]=[d("h1",null,"Network",-1)])]))}),[["__scopeId","data-v-c6d1ea14"]]),je=Object.freeze({__proto__:null,default:Me});const Ne={class:"Upgrade"};var Ve=X(r({o:"index",setup:e=>(e,n)=>(u(),i("div",Ne,[...n[0]||(n[0]=[d("h1",null,"Upgrade",-1)])]))}),[["__scopeId","data-v-b9aad933"]]),Ue=Object.freeze({__proto__:null,default:Ve});const Be={class:"Diagnostics"};var He=X(r({o:"index",setup:e=>(e,n)=>(u(),i("div",Be,[...n[0]||(n[0]=[d("h1",null,"Diagnostics",-1)])]))}),[["__scopeId","data-v-e970c731"]]),Je=Object.freeze({__proto__:null,default:He});const Fe={class:"Admin"};var qe=X(r({o:"index",setup:e=>(e,n)=>(u(),i("div",Fe,[...n[0]||(n[0]=[d("h1",null,"Admin?",-1)])]))}),[["__scopeId","data-v-c0423fb1"]]),Ge=Object.freeze({__proto__:null,default:qe});const We={class:"Login"},ze={class:"Form-box"},Ke={key:0,class:"error-message"},Qe={key:1,class:"error-message"};var Ze=X(r({o:"index",setup(e){const t=z(),o=n(""),s=n(""),r=n({username:"",password:""}),a={username:{required:!0,pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线"},password:{required:!0,minLength:6,message:"密码长度不能少于6位"}},c=e=>{const n="username"===e?o.value:s.value,t=a[e];t.required&&!n?r.value[e]=("username"===e?"用户名":"密码")+"不能为空":t.pattern&&!t.pattern.test(n)||t.minLength&&n.length<t.minLength?r.value[e]=t.message:r.value[e]=""},l=()=>{if(c("username"),c("password"),!r.value.username&&!r.value.password){let e={role:"user",username:o.value,password:s.value};t.Login(e)}};return(e,n)=>(u(),i("div",We,[d("div",ze,[n[4]||(n[4]=d("h1",null,"Login",-1)),h(d("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=e=>o.value=e),placeholder:"用户名",onBlur:n[1]||(n[1]=e=>c("username")),class:f({error:r.value.username})},null,34),[[L,o.value]]),r.value.username?(u(),i("div",Ke,y(r.value.username),1)):b("",!0),h(d("input",{type:"password","onUpdate:modelValue":n[2]||(n[2]=e=>s.value=e),placeholder:"密码",onBlur:n[3]||(n[3]=e=>c("password")),class:f({error:r.value.password})},null,34),[[L,s.value]]),r.value.password?(u(),i("div",Qe,y(r.value.password),1)):b("",!0),d("button",{onClick:l}," 登录 ")])]))}}),[["__scopeId","data-v-001153f4"]]),Xe=Object.freeze({__proto__:null,default:Ze});const Ye={class:"not-found"};var en=r({o:"404",setup(e){const n=H();return(e,t)=>(u(),i("div",Ye,[t[2]||(t[2]=d("h1",null,"404 - 页面未找到",-1)),t[3]||(t[3]=d("p",null,"您访问的页面不存在。",-1)),d("button",{onClick:t[0]||(t[0]=e=>c(n).navigateBack())},"后退"),d("button",{onClick:t[1]||(t[1]=e=>c(n).navigateForward())},"前进")]))}}),nn=Object.freeze({__proto__:null,default:en});const tn={class:"server-error"};var on=X({},[["render",function(e,n){return u(),i("div",tn,[...n[0]||(n[0]=[d("h1",null,"500 - 服务器错误",-1),d("p",null,"服务器遇到了一个错误。",-1)])])}]]),sn=Object.freeze({__proto__:null,default:on});
